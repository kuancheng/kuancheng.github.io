<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>KC's Blog - Current Post</title>

    <!-- Bootstrap Core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../css/clean-blog.min.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"
          type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet'
          type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'
          rel='stylesheet' type='text/css'>
    <link href="http://alexgorbatchev.com/pub/sh/current/styles/shCore.css" rel="stylesheet" type="text/css">
    <link href="http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>

<!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="js/clean-blog.min.js"></script>


    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <script type="text/javascript" src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js"></script>
    <script type="text/javascript" src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushPython.js"></script>

    <![endif]-->

</head>

<body>

<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="../index.html">Home</a>
                </li>
                <li>
                    <a href="../about.html">About</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<!-- Page Header -->
<!-- Set your background image for this header on the line below. -->
<header class="intro-header" style="background-image: url('../img/post-bg.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Pandas and Postgres</h1>
                    <h2 class="subheading">
                        How to transfer Pandas data frame into relational database table?
                    </h2>
                    <span class="meta">Posted by <a href="../about.html">Kuan-Cheng</a> on February 25, 2016</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <p>Hi, today I wanna introduce how to transfer data frame out of
                    <a href="http://pandas.pydata.org/" target="_blank">
                        Pandas
                    </a>
                    into tables stored into relational
                    database. Pandas is a very useful library provided by Python to help data analysts to wrangle with
                    data. It is intuitive and
                    easy to learn.
                    <a href="https://vimeo.com/59324550" target="_blank">
                        (10-minute tour of pandas)
                    </a>
                    Especially, I think Pandas puts a lot of effort to optimize efficiency which means you can deal with
                    a decent amount of
                    data using Pandas. For those people who gets used to R, Python Notebook also provides a way to make
                    these two powerful analysis
                    languages complement with each other.
                    <a href="http://www.r-bloggers.com/pipelining-r-and-python-in-notebooks/" target="_blank">
                        (Pipelining R and Python in Notebooks)
                    </a>
                    .Hence, why not give it a try!?


                    <!-- Finally, to actually run the highlighter, you need to include this JS on your page -->
                    <script type="text/javascript">
                        SyntaxHighlighter.all()
                    </script>
                </p>

                <h2 class="section-heading">Make it easy with Pandas!?</h2>
                <p>
                    Back to our topic, I used to insert data line by line into relational database, which I
                    think it is not pretty efficient and you need write a big chunk of SQL codes like the following code
                    snippets, let alone
                    you need to wrangle with data at the same time. Hence, you can expect your codes will become pretty
                    long, messy and not easy to
                    follow by others.

                    <pre class="brush: py">
                       sql = """INSERT INTO acs5_stats (
                             tract_geoid, acs5_year, median_income, unemployment_rate, median_age, poverty_rate,
                             rent_income_ratio, vacancy_rate, owner_rate, renter_rate, less_high_school_rate,
                             high_school_rate, some_college_rate, bachelor_rate, graduate_rate, white_percent,
                             black_percent, hispanic_percent, asian_percent, other_percent)
                             VALUES (
                             %(tract_geoid)s,
                             %(acs5_year)s,
                             %(median_income)s,
                             %(unemployment_rate)s,
                             %(median_age)s,
                             %(poverty_rate)s,
                             %(rent_income_ratio)s,
                             %(vacancy_rate)s,
                             %(owner_rate)s,
                             %(renter_rate)s,
                             %(less_high_school_rate)s,
                             %(high_school_rate)s,
                             %(some_college_rate)s,
                             %(bachelor_rate)s,
                             %(graduate_rate)s,
                             %(white_percent)s,
                             %(black_percent)s,
                             %(hispanic_percent)s,
                             %(asian_percent)s,
                             %(other_percent)s
                          )"""
                    </pre>

                However, Pandas provides a handy method for people to easily and smoothly transfer data into relation
                database which is
                <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.to_sql.html"
                   target="_blank">
                    to_sql.
                </a>
                All you need to do is just set up the connection and specify some parameters inside the method. Look at
                my example code below:

                <pre class="brush: py">
                    import pandas as pd
                    '''
                        Since I am using Postgres, which is not supported by
                        the flavor of this method, I need to use sqlalchmy
                        to create a connection
                    '''
                    from sqlalchemy import create_engine

                    '''
                     url sample:
                       dialect+driver://username:password@host:port/database
                     dialect: postgresql
                     driver: psycopg2
                     username: kuan
                     password: 1234
                     host: localhost
                     port: 5432 (port number to connect to postgres database is 5432,
                       different vendors may use different port number)
                     database: mydb
                    '''

                    url = 'postgresql+psycopg2://kuan:1234@localhost:5432/mydb'
                    engine = create_engine(url)

                    #Load data locally
                    df = pd.read_csv("your/directory/data.csv)

                    '''
                     name: table name in your database
                     con: connection you created to your database
                     schema: specify if you want to insert data to
                        certain schema instead of default one
                     if_exists: it will append the table if the table
                        already existed
                     index: If to write data frame's index as a column
                    '''
                    df.to_sql(name='mytable', con=engine, schema="myschema",
                        if_exists='append', index=False)
                </pre>
                It is so pretty easy right!? I think it incredibly reduces the amount of codes and make your
                applications neat and easy to read and follow. Only thing I think need to be careful
                is to correctly connect to database. Once you have no problem connect to your database, Pandas will
                magically take care of the other stuff!. Alright, see you next time and happy coding!


                </p>
            </div>
        </div>
    </div>
</article>

<hr>

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="https://twitter.com/lai_cheng" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://www.linkedin.com/in/kuanchenglai" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/kuancheng" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                    </li>
                    <li>
                        <a href="resume/Resume-Lai.pdf" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-male fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                    </li>
                </ul>
                <p class="copyright text-muted">Copyright &copy; Kuan-Cheng's Website 2016</p>
            </div>
        </div>
    </div>
</footer>


</body>

</html>
